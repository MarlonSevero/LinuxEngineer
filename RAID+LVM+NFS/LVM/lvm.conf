üîπ PASSO A PASSO LVM üîπ

LVM (Logic Volume Manager) √© uma forma de gerenciar discos e parti√ß√µes de forma mais flex√≠vel.
Ele permitir√° que voc√™ aumente ou reduza volumes facilmente, aumentando ou diminuindo o espa√ßo, sem precisar mover ou formatar tudo.

‚∏ª

1Ô∏è‚É£ Instala√ß√£o do LVM:

apt install lvm2 -y


‚∏ª

2Ô∏è‚É£ PV (Physical Volume)

Primeiro criamos o Physical Volume:

pvscan  # verifica se j√° temos PVs
pvcreate /dev/md0   # ou o seu dispositivo (/dev/md0 para RAID)
pvs                   # lista os PVs
pvdisplay             # exibe detalhes do PV


‚∏ª

3Ô∏è‚É£ VG (Volume Group)

Depois, criamos o Volume Group:

vgcreate storage /dev/md0
vgs
vgdisplay storage


‚∏ª

4Ô∏è‚É£ LV (Logic Volume)

Com o Volume Group criado, √© hora de criar o Volume L√≥gico:

lvcreate -n lv_dados -L 10G storage
# -n -> nome do LV
# -L -> tamanho
# storage -> o nome do VG onde ele ser√° criado

Depois, √© poss√≠vel verificar:

lvscan
lvs
lvdisplay


‚∏ª

5Ô∏è‚É£ Formato do LV:

Depois que o LV √© criado, ele precisa ser formatado:

mkfs.ext4 /dev/storage/lv_dados


‚∏ª

6Ô∏è‚É£ Cria√ß√£o do diret√≥rio de montagem:

mkdir /mnt/dados


‚∏ª

7Ô∏è‚É£ Montar o LV:

mount /dev/storage/lv_dados /mnt/dados


‚∏ª

8Ô∏è‚É£ Configurar o fstab (montagem permanente):

Edite o /etc/fstab acrescentando:

/dev/storage/lv_dados   /mnt/dados   ext4   defaults   0   0

Depois:

mount -a

Isso faz com que o LV seja montado automaticamente junto com o inicio do Linux.
Para verificar:

df -hT


‚∏ª

üîπ REDU√á√ÉO DE VOLUMES üîπ

‚∏ª

1Ô∏è‚É£ Desmontar o volume:

umount /mnt/dados


‚∏ª

2Ô∏è‚É£ Realizar a checagem do sistema de arquivos:

e2fsck -f /dev/storage/lv_dados


‚∏ª

3Ô∏è‚É£ Reduzir o tamanho do sistema de arquivos:

resize2fs /dev/storage/lv_dados 5G
# 5G √© o tamanho para o qual quer reduzir


‚∏ª

4Ô∏è‚É£ Reduzir o volume l√≥gico (LVM) propriamente:

lvreduce -L 5G /dev/storage/lv_dados
# 5G deve ser o MESMO tamanho ou maior que o do sistema de arquivos


‚∏ª

5Ô∏è‚É£ Montar o volume novamente:

mount /dev/storage/lv_dados /mnt/dados

‚∏ª

‚∏ª

üîπ AUMENTO DE VOLUMES üîπ

‚∏ª

1Ô∏è‚É£ Desmontar o volume (opcional, se o FS n√£o for online-resizable)

umount /mnt/dados

Alguns sistemas de arquivos, como o ext4, permitem a execu√ß√£o do resize2fs online.
Nesse caso, o umount n√£o √© obrigat√≥rio.
Mas √© uma boa pr√°tica desmontar para maior seguran√ßa.

‚∏ª

2Ô∏è‚É£ Aumentar o volume l√≥gico (LVM)

lvextend -L +5G /dev/storage/lv_dados
# +5G acrescentar√° 5 GiB ao volume


‚∏ª

3Ô∏è‚É£ Realizar a checagem do sistema de arquivos (opcional, mas recomendado)

e2fsck -f /dev/storage/lv_dados


‚∏ª

4Ô∏è‚É£ Redimensionalo o sistema de arquivos para usar o espa√ßo extra:

resize2fs /dev/storage/lv_dados


‚∏ª

5Ô∏è‚É£ Montar o volume novamente:

mount /dev/storage/lv_dados /mnt/dados


‚∏ª